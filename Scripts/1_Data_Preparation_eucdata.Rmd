---
title: "Data Preparation Using Eucdata"
output:
  html_document:
    df_print: paged
---


This new dataprep version uses the trait_medians object (long-format data) from the eucdata package which automatically removes the grampians SD from the combined_traits object from which those traits are calculated. The allometric traits of Relative Height and Relative Bark Thickness recalculated according to a more accurate model as of November 2020, same as the previous version. The medians here were calculated after data from each of the four datasets were pooled rather than the the previous method (which also used the datasets from the eucdata package instead) where the medians were taken first by dataset and then by taxon for those taxa that occured in more than a single dataset. The max. height data also came from taking the median of all the subspecies where it was not specifies unless otherwise stated. 
    -I need to re-check so of the subspecies that were originally manually assigned and keep my        assignment for those where I'm sure (based on distribution etc.) that my previously              manually assigned value is more correct.


## All Required Packages and Functions

```{r}
# for re-checking code September 2022
# install.packages("devtools")
# devtools::install_github('EucTraitEcology/eucdata',
#                           ref = 'main',
#                           auth_token = "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", force = TRUE)



# library(devtools) # only needed for installing the eucdata package
library(eucdata) # New data repository
library(dplyr)
library(readxl) # to input data from csv, especially taxon name-status checking
library(ggplot2) # for plots checking traits of E. sieberi and assumption it can be included in the combination resprouter category
library(gridExtra) # for the 'grid.arrange' function allowing arrangement of multiple plots on the same image
library(sf) # don't use directly as doesn't need to be loaded, but required to be installed in order to install ozmaps
library(ozmaps) # required for sampling map of collecting locations
library(viridis) # required for colours on map of collecting locations
```



## Data Preparation


```{r}
# extra chunk until we can get eucdata package to download
combined_traits <- read.csv('../Input_data/combined_traits.csv')
trait_medians <- read.csv('../Input_data/trait_medians.csv')
euclid <- read.csv('../Input_data/euclid.csv')
```

```{r}
# this is the long-form row-bound pooled data from all datasets with the grampians SD data removed
trait.data.full <- combined_traits 

# this is the calculated medians from the eucdata package with the max height added from the EUCLID database and all 170 taxa with measured data and all traits for which there is any data even if only in a sigle dataset
trait.medians <- trait_medians 

#to record what species there is data for in each of the 4 datasets that were pooled together
taxa.grp <- unique(trait.data.full[trait.data.full$dataset == 'grampians', c('taxon')])
taxa.mall <- unique(trait.data.full[trait.data.full$dataset == 'mallee', c('taxon')]) 
taxa.se <- unique(trait.data.full[trait.data.full$dataset == 'southeast', c('taxon')])
taxa.wa <- unique(trait.data.full[trait.data.full$dataset == 'stirling', c('taxon')])

# total taxa including duplicated lines, 170 plus 11 duplicated
sum(length(taxa.grp), length(taxa.mall), length(taxa.se), length(taxa.wa)) 

taxa.in.2.datasets <- unlist(list(taxa.grp, taxa.mall, taxa.se, taxa.wa))[duplicated(unlist(list(taxa.grp, taxa.mall, taxa.se, taxa.wa)))]

# Column of all unique taxon names
all.taxa <- data.frame('taxon' = unique(trait.data.full$taxon))

# Extracting initial datasets and, for duplicated taxa, second datasets in which they occur (to be joined later on)
datasets <- unique(trait.data.full[c('taxon', 'dataset')])
datasets2 <- unique(trait.data.full[c('taxon','dataset')])[duplicated(unique(trait.data.full[c('taxon', 'dataset')])$taxon),]
names(datasets2) <- c('taxon', 'dataset2')
```


The mallee species are mostly not in the euclid list bc their status as a species is not well supported and they are controversial. The WA ones mostly need a subspecies specification to match, though E. decipiens has some taxonomic ambiguity. E. vergrandis does not exist as a taxon but E. vegrandis does so I can assume that's a typo.


Ambiguously resolved taxa will be excluded from the phylogeny (those three taxa for whom the subspecies could not be resolved, and the unspecified 'Eucalyptus' from the mallee dataset), along with the unspecified subspecies 'Eucalyptus pauciflora' (since there are already samples from every other subspecies of it including the autonymic subspecies). All but three remaining taxa in the dataset are not considered current according to APC (2021), but we use the superceded names for inernal consistency throughout this document:
E. costata subsp. murrayana (now known as E. cinerea subsp. triplex)
E. cinerea subso. victoriensis (now known as E. incrassata)
E. decipiens subsp. chalara (intergrade between E. decipiens and E. adesmophloia)


Missing heights inferred are as follows:

E. costata subsp. murrayana: 8m (height of E. incrassata to which this taxon is now considered to belong)  
E. silvestris: 7m (that of E. odorata to which this taxon now belongs)  
E. wimmerensis: 8m (that of the taxa this species is poorly resolved from and for which height data is available) 
E. vergrandis: 6m (that of both ssp. of E. vegrandis)  
Lophostemon confertus: 40m according to Rob Kooyman (AusTraits Database) as this taxon is not in the genus Eucalyptus

Height inferred for taxa where the median height of all subspecies was not used as the exact subspecies likely collected could be determined from species' ranges:
E. preissiana: 2.5m, height of subsp. preissiana as other subspecies' range does not include the collecting area (Stirling NP, WA)
E. wandoo: 18m, height of subsp. wandoo (othe subsp. has seperate and restricted distribution)
E. rudis: 20m, height of subsp. rudis (othe subsp. has seperate, restricted distribution not as close to collecting area)
E. flocktoniae: 8m, height of subsp. flocktoniae (other subsp. has far more restricted and removed distribution)



```{r}
# adding max heights that were missing entirely from the euclid heights column in trait.medians
trait.medians[trait.medians$taxon == 'Eucalyptus costata subsp. murrayana', c('max_height_m')] <- 8
trait.medians[trait.medians$taxon == 'Eucalyptus silvestris', c('max_height_m')] <- 7
trait.medians[trait.medians$taxon == 'Eucalyptus wimmerensis', c('max_height_m')] <- 8
trait.medians[trait.medians$taxon == 'Eucalyptus vergrandis', c('max_height_m')] <- 6
trait.medians[trait.medians$taxon == 'Lophostemon confertus', c('max_height_m')] <- 40

#now add max heights for taxa we can resonably be sure which subspecies was collected based on different subspecies having different distribution, and so we don't want to just leave those as the calculated median max. height for all subspecies
trait.medians[trait.medians$taxon == 'Eucalyptus preissiana',
              c('max_height_m')] <- 2.5
trait.medians[trait.medians$taxon == 'Eucalyptus wandoo',
              c('max_height_m')] <- 18
trait.medians[trait.medians$taxon == 'Eucalyptus rudis',
              c('max_height_m')] <- 20
trait.medians[trait.medians$taxon == 'Eucalyptus flocktoniae',
              c('max_height_m')] <- 8
```

Now to get rid of taxa that are being excluded because their taxonomic resolution is strange and we won't know where to place them on the tree.

```{r}
# gets rid of the three with the "pipe" symbol for now
all.taxa.clean <- all.taxa[!grepl(".)", all.taxa$taxon),] 

# gets rid of unspecified taxa
all.taxa.clean <- all.taxa.clean[!all.taxa.clean == "Eucalyptus" &
                                   !all.taxa.clean == "Eucalyptus pauciflora"]

all.taxa.clean <- data.frame('taxon' = all.taxa.clean)
write.csv(all.taxa.clean, '../Input_data/all.taxa.clean.csv')

# new medians with 3 pipe-symbol taxa, Eucalyptus, and E. pauciflora removed so now there's 165 taxa
trait.medians <- trait.medians[trait.medians$taxon %in% all.taxa.clean$taxon,] 
```


### Which of the traits are we inlcuding in our analysis?

Not all datasets have the same set of traits measured.
The mallee dataset was most limiting and only has data for: SLA, leaf area, leaf mass, fruit mass, seed mass. The remaining datasets include fruit wall thickness and only the southeast and stirling datasets include stem density, relative height by girth and relative bark thickness by girth. While only the mallee traits will be measured for almost all taxa, the remaining aforementioned traits cover enough different aspects of functional dimensions and are measured in enough taxa to be able to feasibly draw conclusions.


```{r}
trait.medians <- trait.medians[c('taxon', 'max_height_m', 'allometric_height_girth',
                                 'stem_density_g_per_ml', 'allometric_bark_girth',
                                 'sla_mm2_per_mg', 'leaf_area_cm2', 'leaf_mass_g',
                                 'fruit_wall_width_mm', 'fruit_mass_mg', 'seed_mass_mg')]

names(trait.medians)[names(trait.medians) == 'allometric_height_girth'] <- 'relative_height_by_girth'
names(trait.medians)[names(trait.medians) == 'allometric_bark_girth'] <- 'relative_bt_by_girth'
```


```{r}
eucs.data.prel <- trait.medians %>%
  left_join(datasets[!duplicated(datasets$taxon),]) %>%
  left_join(datasets2)

eucs.data.prel <- eucs.data.prel[, c("taxon", "dataset", "dataset2", "max_height_m",
                                   "relative_height_by_girth", "stem_density_g_per_ml",
                                   "relative_bt_by_girth", "sla_mm2_per_mg", "leaf_area_cm2",
                                   "leaf_mass_g", "fruit_wall_width_mm", "fruit_mass_mg",
                                   "seed_mass_mg")]
```



### Adding Fire-Response Traits

The following fire response data was sourced from Nicolle (2006). Only a single taxon included in the phylogeny is a stem sprouter (Eucalyptus sieberi), the fire responses exhibited by the remaining taxa are either obligate seeding, resprouting from a lignotuber, or capable of resprouting from both a lignotuber and epicormic buds in the stems (combination sprouters).

```{r}
# Reading in and formatting the fire response data
fire.data <- read_excel("../Input_data/fire_data.xlsx", sheet = "fire.response")
## removed NA rows and selected the columns that contain the data itself
fire.data <- data.frame(fire.data[!is.na(fire.data$taxon), c("taxon", "Sprouter", "Type")]) 

# Assigning categories to binary of resprouting ability
fire.data[fire.data == "NA"] <- NA
## assigning all the resprouters to the dummy variable 1
fire.data[fire.data == "S"] <- 1 
## assigning obligate seeders to 0
fire.data[fire.data == "O"] <- 0 
## just the sprouter variable
sprouting.broad <- data.frame(fire.data[c("taxon", "Sprouter")]) 


# now to add and code the fire data by whether or not they can sprout from either the lignotuber or stem
sprouting.detailed <- data.frame("taxon" = fire.data$taxon, "Stem_Sprouter" = fire.data$Type)
## combination sprouters are also stem sprouters
sprouting.detailed[sprouting.detailed == 'C'] <- 1 
## deciding to code variable species as capable of stem sprouting sometimes so being included in that category
sprouting.detailed[sprouting.detailed == 'Var.'] <- 1 
## to include the orthographic variation of the categories
sprouting.detailed[sprouting.detailed == 'Var'] <- 1 
## stem sprouters coded as able to epicormically resprout, but this means it is coded the same as combination resprouters (sprouter = 1 & epicormic = 1)
sprouting.detailed[sprouting.detailed == 'St'] <- 1
## lignotuber-only sprouters can't resprout from the stem
sprouting.detailed[sprouting.detailed == 'L'] <- 0

# Now to create the column coding for lignotuber resprouting ability (of any kind including taxa that can also resprout epicormically)
ligno.col <- data.frame("Lignotuber_Sprouter" = fire.data$Type)
ligno.col[ligno.col == 'L'] <- 1
# true in almost all cases, only E. sieberi is a stem-only sprouter
ligno.col[ligno.col == 'C'] <- 1 
ligno.col[ligno.col == 'St'] <- 0
ligno.col[ligno.col == 'Var'] <- 1
ligno.col[ligno.col == 'Var.'] <- 1

# checking if the resprouter and lignotuber resprouter column all but identical i.e. all but one species that can resprout. 
## The only difference is the one taxon that is a stem sprouter
sum(!ligno.col$Lignotuber_Sprouter == fire.data$Sprouter, na.rm = TRUE) 

# joining the columns together
sprouting.detailed <- cbind(sprouting.detailed, ligno.col)
eucs.fire.data <- left_join(sprouting.broad, sprouting.detailed)
## and for future use and completeness, since not every analysis requires scaled data:
eucs.data.prel <- left_join(eucs.data.prel, eucs.fire.data) 

# Now to include the case where the 10 variably-stem-sprouting taxa are NOT considered as Stem sprouters (equally valid approach):
sprouting.detailed2 <- data.frame("taxon" = fire.data$taxon, "Stem_Sprouter" = fire.data$Type)
## combination sprouters are also stem sprouters
sprouting.detailed2[sprouting.detailed2 == 'C'] <- 1 
## deciding to code variable species non-stem-sprouting, as they're incapable of stem sprouting reliably
sprouting.detailed2[sprouting.detailed2 == 'Var.'] <- 0 
## to include the orthographic variation there
sprouting.detailed2[sprouting.detailed2 == 'Var'] <- 0 
sprouting.detailed2[sprouting.detailed2 == 'St'] <- 1
sprouting.detailed2[sprouting.detailed2 == 'L'] <- 0

# renaming the column in this alternatively coded dataset
names(sprouting.detailed2)[names(sprouting.detailed2) == 'Stem_Sprouter'] <- 'Stem_Sprouter2'

eucs.fire.data <- left_join(eucs.fire.data, sprouting.detailed2)

eucs.data.prel <- left_join(eucs.data.prel, sprouting.detailed2)

# column of lignotuber-only 
ligno.only <- data.frame('Lignotuber_Only' = eucs.data.prel$Lignotuber_Sprouter)
## this will also allow us to select the rows of lignotuber_sprouter that correspond to combinations sprouters
is.combo.sprouter <- eucs.data.prel$Stem_Sprouter == 1 
is.combo.sprouter[is.na(is.combo.sprouter)] <- FALSE
ligno.only[is.combo.sprouter,] <- 0
eucs.data.prel <- cbind(eucs.data.prel, ligno.only)

# now adding in a character column stating all three categories instead of using binary variables that only partially answer the question, used more often later in the analysis, but also easier to create from existing binary variables
cat.sprout <- data.frame('Sprouting_Type' = rep(NA, length(eucs.data.prel$taxon)))
eucs.data.prel <- cbind(eucs.data.prel, cat.sprout)
eucs.data.prel$Sprouting_Type[ligno.only == 1] <- 'Lignotuber_Only'
eucs.data.prel$Sprouting_Type[eucs.data.prel$Sprouter == 0] <- 'Obligate_Seeder'
eucs.data.prel$Sprouting_Type[eucs.data.prel$Stem_Sprouter == 1] <- 'Combination_Sprouter'
eucs.data.prel$Sprouting_Type <- as.factor(eucs.data.prel$Sprouting_Type)
## checking how many lignotube-only/basal-only resprouters we have in the dataset: 36 btw
sum(ligno.only == 1, na.rm = TRUE)

#for the alternate designation of 10 variable taxa as lignotuber-only repsrouters still using the same 3-level categorical variable method
eucs.data.prel <- cbind(eucs.data.prel, data.frame('Sprouting_Type2' = as.character(eucs.data.prel$Sprouting_Type)))
eucs.data.prel$Sprouting_Type2[eucs.data.prel$Sprouter == 1 & eucs.data.prel$Stem_Sprouter2 == 0 & !is.na(eucs.data.prel$Stem_Sprouter2) & eucs.data.prel$Sprouting_Type2 == 'Combination_Sprouter'] <- 'Lignotuber_Only'
eucs.data.prel$Sprouting_Type2 <- as.factor(eucs.data.prel$Sprouting_Type2)

# Also we might want to determine where E. sieberi (the only stem-only resprouter in our data set) is in the datacloud by creating another column (just 1 and 0 should suffice for just looking at it later)
sieberi <- data.frame('Sieberi' = rep(NA, length(eucs.data.prel$taxon)))
eucs.data.prel <- cbind(eucs.data.prel, sieberi)
eucs.data.prel$Sieberi[eucs.data.prel$taxon == 'Eucalyptus sieberi'] <- 'Y'
eucs.data.prel$Sieberi[!eucs.data.prel$taxon == 'Eucalyptus sieberi'] <- 'N'
```

### Final Datasets

```{r}
# this pgls method being used in this analysis requires a taxon column rather than taxa in rownames
eucs.data <- data.frame(eucs.data.prel) 
cat.cols <- c("taxon", "dataset", "dataset2", "Sprouter", "Stem_Sprouter", "Lignotuber_Sprouter", "Stem_Sprouter2", "Lignotuber_Only", "Sprouting_Type", "Sprouting_Type2", "Sieberi")
eucs.log.data <- eucs.data
eucs.log.data[, !names(eucs.log.data) %in% cat.cols] <- lapply(eucs.log.data[, !names(eucs.log.data) %in% cat.cols], log10)
eucs.scaled.data <- eucs.log.data
eucs.scaled.data[, !names(eucs.scaled.data) %in% cat.cols] <- lapply(eucs.scaled.data[, !names(eucs.log.data) %in% cat.cols], scale)

# now to save each of these as objects in r
write.csv(eucs.data, file = "../Input_data/eucs_data.csv")
write.csv(eucs.log.data, file = "../Input_data/eucs_log_data.csv")
write.csv(eucs.scaled.data, file = "../Input_data/eucs_scaled_data.csv")
```


# Testing Sieberi Position

Since, we have included E. sieberi, the only stem-only resprouter in the dataset, in with the combination resprouters, we want to check how valid of an assumption that is based on where its trait values tend to fall. I want to know where in the distributions of combo sprouters lies to see if it is an outlier w.r.t. any of the categories.

```{r}
# first to add an additional category to the data to delineate E. sieberi and call it a stem sprouter
sieberi.position.data <- as.data.frame(eucs.data[c("taxon", "max_height_m", "relative_height_by_girth", "stem_density_g_per_ml", "relative_bt_by_girth", "sla_mm2_per_mg", "leaf_area_cm2", "leaf_mass_g", "fruit_wall_width_mm", "fruit_mass_mg", "seed_mass_mg", "Sprouting_Type")])
sieberi.position.data$Sprouting_Type1.1 <- as.character(sieberi.position.data$Sprouting_Type)
sieberi.position.data[sieberi.position.data$taxon == "Eucalyptus sieberi", names(sieberi.position.data) == "Sprouting_Type1.1"] <- "Stem_Sprouter"
sieberi.position.data$Sprouting_Type1.1 <- as.factor(sieberi.position.data$Sprouting_Type1.1)

sieberi.mh <- ggplot(data = sieberi.position.data, 
         aes(x = Sprouting_Type1.1, y = max_height_m, fill = Sprouting_Type1.1)) +
  geom_point(aes(y = max_height_m, color = Sprouting_Type1.1), position = position_jitter(width = .15, seed =1), size = 2, alpha = 0.6) +
  geom_boxplot(width = .6, outlier.shape = NA, alpha = 0.15) +
  expand_limits(x = 5.25) +
  guides(fill = FALSE) +
  guides(color = FALSE) + scale_x_discrete(limits = c("Combination_Sprouter", "Stem_Sprouter", "Obligate_Seeder", "Lignotuber_Only"), labels = c("Combination\nResprouter", "Stem\nResprouter", "Obligate\nSeeder", "Basal-Only\nResprouter")) + scale_y_continuous(trans = "log10", breaks = c(1, 3, 10, 30, 100)) + coord_flip() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"), axis.text.x = element_text(size = 25), axis.text.y = element_text(size = 25), axis.title.x = element_text(size = 25, vjust = -1.5), plot.margin = margin(l=0.1,b=2,1,1, "cm")) + labs(y="Maximum Height (m)", x = "")

sieberi.rh <- ggplot(data = sieberi.position.data, 
         aes(x = Sprouting_Type1.1, y = relative_height_by_girth, fill = Sprouting_Type1.1)) +
  geom_point(aes(y = relative_height_by_girth, color = Sprouting_Type1.1), position = position_jitter(width = .15, seed =1), size = 2, alpha = 0.6) +
  geom_boxplot(width = .6, outlier.shape = NA, alpha = 0.15) +
  expand_limits(x = 5.25) +
  guides(fill = FALSE) +
  guides(color = FALSE) + scale_x_discrete(limits = c("Combination_Sprouter", "Stem_Sprouter", "Obligate_Seeder", "Lignotuber_Only"), labels = c("", "", "", "")) + scale_y_continuous(trans = "log10", breaks = c(6, 10, 20, 30)) + coord_flip() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"), axis.text.x = element_text(size = 25), axis.text.y = element_text(size = 25), axis.title.x = element_text(size = 25, vjust = -1.5), plot.margin = margin(l=0.1,b=2,1,1, "cm")) + labs(y="Relative Height (m)", x = "")


sieberi.sd <- ggplot(data = sieberi.position.data, 
         aes(x = Sprouting_Type1.1, y = stem_density_g_per_ml, fill = Sprouting_Type1.1)) +
  geom_point(aes(y = stem_density_g_per_ml, color = Sprouting_Type1.1), position = position_jitter(width = .15, seed =1), size = 2, alpha = 0.6) +
  geom_boxplot(width = .6, outlier.shape = NA, alpha = 0.15) +
  expand_limits(x = 5.25) +
  guides(fill = FALSE) +
  guides(color = FALSE) + scale_x_discrete(limits = c("Combination_Sprouter", "Stem_Sprouter", "Obligate_Seeder", "Lignotuber_Only"), labels = c("", "", "", "")) + scale_y_continuous(trans = "log10", breaks = c(0.51,0.55, 0.60, 0.70, 0.80)) + coord_flip() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"), axis.text.x = element_text(size = 25), axis.text.y = element_text(size = 25), axis.title.x = element_text(size = 25, vjust = -1.5), plot.margin = margin(l=0.1,b=2,1,1, "cm")) + labs(y="Stem Density (g/mL)", x = "")

sieberi.rbt <- ggplot(data = sieberi.position.data, 
         aes(x = Sprouting_Type1.1, y = relative_bt_by_girth, fill = Sprouting_Type1.1)) +
  geom_point(aes(y = relative_bt_by_girth, color = Sprouting_Type1.1), position = position_jitter(width = .15, seed =1), size = 2, alpha = 0.6) +
  geom_boxplot(width = .6, outlier.shape = NA, alpha = 0.15) +
  expand_limits(x = 5.25) +
  guides(fill = FALSE) +
  guides(color = FALSE) + scale_x_discrete(limits = c("Combination_Sprouter", "Stem_Sprouter", "Obligate_Seeder", "Lignotuber_Only"), labels = c("Combination\nResprouter", "Stem\nResprouter", "Obligate\nSeeder", "Basal-Only\nResprouter")) + scale_y_continuous(trans = "log10", breaks = c(5, 10, 20, 40)) + coord_flip() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"), axis.text.x = element_text(size = 25), axis.text.y = element_text(size = 25), axis.title.x = element_text(size = 25, vjust = -1.5), plot.margin = margin(l=0.1,b=2,1,1, "cm")) + labs(y="Relative Bark Thickness (mm)", x = "")

sieberi.sla <- ggplot(data = sieberi.position.data, 
         aes(x = Sprouting_Type1.1, y = sla_mm2_per_mg, fill = Sprouting_Type1.1)) +
  geom_point(aes(y = sla_mm2_per_mg, color = Sprouting_Type1.1), position = position_jitter(width = .15, seed =1), size = 2, alpha = 0.6) +
  geom_boxplot(width = .6, outlier.shape = NA, alpha = 0.15) +
  expand_limits(x = 5.25) +
  guides(fill = FALSE) +
  guides(color = FALSE) + scale_x_discrete(limits = c("Combination_Sprouter", "Stem_Sprouter", "Obligate_Seeder", "Lignotuber_Only"), labels = c("", "", "", "")) + scale_y_continuous(trans = "log10", breaks = c(2,4,8)) + coord_flip() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"), axis.text.x = element_text(size = 25), axis.text.y = element_text(size = 25), axis.title.x = element_text(size = 25, vjust = -1.5), plot.margin = margin(l=0.1,b=2,1,1, "cm")) + labs(y="SLA (mm2/mg)", x = "")

sieberi.la <- ggplot(data = sieberi.position.data, 
         aes(x = Sprouting_Type1.1, y = leaf_area_cm2, fill = Sprouting_Type1.1)) +
  geom_point(aes(y = leaf_area_cm2, color = Sprouting_Type1.1), position = position_jitter(width = .15, seed =1), size = 2, alpha = 0.6) +
  geom_boxplot(width = .6, outlier.shape = NA, alpha = 0.15) +
  expand_limits(x = 5.25) +
  guides(fill = FALSE) +
  guides(color = FALSE) + scale_x_discrete(limits = c("Combination_Sprouter", "Stem_Sprouter", "Obligate_Seeder", "Lignotuber_Only"), labels = c("", "", "", "")) + scale_y_continuous(trans = "log10", breaks = c(3,10,30,100)) + coord_flip() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"), axis.text.x = element_text(size = 25), axis.text.y = element_text(size = 25), axis.title.x = element_text(size = 25, vjust = -1.5), plot.margin = margin(l=0.1,b=2,1,1, "cm")) + labs(y="Leaf Area (cm2)", x = "")

sieberi.lm <- ggplot(data = sieberi.position.data, 
         aes(x = Sprouting_Type1.1, y = leaf_mass_g, fill = Sprouting_Type1.1)) +
  geom_point(aes(y = leaf_mass_g, color = Sprouting_Type1.1), position = position_jitter(width = .15, seed =1), size = 2, alpha = 0.6) +
  geom_boxplot(width = .6, outlier.shape = NA, alpha = 0.15) +
  expand_limits(x = 5.25) +
  guides(fill = FALSE) +
  guides(color = FALSE) + scale_x_discrete(limits = c("Combination_Sprouter", "Stem_Sprouter", "Obligate_Seeder", "Lignotuber_Only"), labels = c("Combination\nResprouter", "Stem\nResprouter", "Obligate\nSeeder", "Basal-Only\nResprouter")) + scale_y_continuous(trans = "log10", breaks = c(0.1, 0.3, 1, 3)) + coord_flip() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"), axis.text.x = element_text(size = 25), axis.text.y = element_text(size = 25), axis.title.x = element_text(size = 25, vjust = -1.5), plot.margin = margin(l=0.1,b=2,1,1, "cm")) + labs(y="Leaf Mass (g)", x = "")

sieberi.fww <- ggplot(data = sieberi.position.data, 
         aes(x = Sprouting_Type1.1, y = fruit_wall_width_mm, fill = Sprouting_Type1.1)) +
  geom_point(aes(y = fruit_wall_width_mm, color = Sprouting_Type1.1), position = position_jitter(width = .15, seed =1), size = 2, alpha = 0.6) +
  geom_boxplot(width = .6, outlier.shape = NA, alpha = 0.15) +
  expand_limits(x = 5.25) +
  guides(fill = FALSE) +
  guides(color = FALSE) + scale_x_discrete(limits = c("Combination_Sprouter", "Stem_Sprouter", "Obligate_Seeder", "Lignotuber_Only"), labels = c("", "", "", "")) + scale_y_continuous(trans = "log10", breaks = c(0.5, 1, 2, 4)) + coord_flip() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"), axis.text.x = element_text(size = 25), axis.text.y = element_text(size = 25), axis.title.x = element_text(size = 25, vjust = -1.5), plot.margin = margin(l=0.1,b=2,1,1, "cm")) + labs(y="Fruit Wall Width (mm)", x = "")

sieberi.fm <- ggplot(data = sieberi.position.data, 
         aes(x = Sprouting_Type1.1, y = fruit_mass_mg, fill = Sprouting_Type1.1)) +
  geom_point(aes(y = fruit_mass_mg, color = Sprouting_Type1.1), position = position_jitter(width = .15, seed =1), size = 2, alpha = 0.6) +
  geom_boxplot(width = .6, outlier.shape = NA, alpha = 0.15) +
  expand_limits(x = 5.25) +
  guides(fill = FALSE) +
  guides(color = FALSE) + scale_x_discrete(limits = c("Combination_Sprouter", "Stem_Sprouter", "Obligate_Seeder", "Lignotuber_Only"), labels = c("", "", "", "")) + scale_y_continuous(trans = "log10", breaks = c(50, 500, 5000)) + coord_flip() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"), axis.text.x = element_text(size = 25), axis.text.y = element_text(size = 25), axis.title.x = element_text(size = 25, vjust = -1.5), plot.margin = margin(l=0.1,b=2,1,1, "cm")) + labs(y="Fruit Mass (mg)", x = "")


sieberi.sm <- ggplot(data = sieberi.position.data, 
         aes(x = Sprouting_Type1.1, y = seed_mass_mg, fill = Sprouting_Type1.1)) +
  geom_point(aes(y = seed_mass_mg, color = Sprouting_Type1.1), position = position_jitter(width = .15, seed =1), size = 2, alpha = 0.6) +
  geom_boxplot(width = .6, outlier.shape = NA, alpha = 0.15) +
  expand_limits(x = 5.25) +
  guides(fill = FALSE) +
  guides(color = FALSE) + scale_x_discrete(limits = c("Combination_Sprouter", "Stem_Sprouter", "Obligate_Seeder", "Lignotuber_Only"), labels = c("Combination\nResprouter", "Stem\nResprouter", "Obligate\nSeeder", "Basal-Only\nResprouter")) + scale_y_continuous(trans = "log10", breaks = c(0.5, 5, 50)) + coord_flip() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"), axis.text.x = element_text(size = 25), axis.text.y = element_text(size = 25), axis.title.x = element_text(size = 25, vjust = -1.5), plot.margin = margin(l=0.1,b=2,1,1, "cm")) + labs(y="Seed Mass (mg)", x = "")

pdf("../Output_figures/sieberi_position.pdf", width = 21, height = 30)
grid.arrange(sieberi.mh, sieberi.rh, sieberi.sd, sieberi.rbt, sieberi.sla, sieberi.la, sieberi.lm, sieberi.fww, sieberi.fm, sieberi.sm, nrow = 4)
dev.off()
```


# Sampling Map

```{r}
# plainest black
ggplot() + theme_void() + geom_sf(data = ozmap_states, fill = 'white', lwd = 0.1) + coord_sf(xlim = c(114, 153), ylim = c(-43,-10)) + geom_point(
    aes(longitude_gda94, latitude_gda94),
    trait.data.full[trait.data.full$taxon %in% eucs.data$taxon,], size = 0.9, alpha = 0.5, color = 'black', pch = 17) +
  xlab("Longitude") +
  ylab("Latitude")

pdf('Output_figures/map_of_collecting_locations.pdf')
ggplot() + theme_void() + geom_sf(data = ozmap_states, fill = 'white', lwd = 0.1) + coord_sf(xlim = c(114, 153), ylim = c(-43,-10)) + geom_point(
    aes(longitude_gda94, latitude_gda94),
    trait.data.full[trait.data.full$taxon %in% eucs.data$taxon,], size = 2, alpha = 0.5, color = 'black', pch = 17)
dev.off()
```

